!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.legoVPNPC=e():t.legoVPNPC=e()}(global,(function(){return(()=>{var t={163:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.runDown=void 0;const s=n(402),i=r(n(673));e.runDown=async function(t){try{if((await i.default.getInstance().status()).BackendState===s.State.Stopped)return void console.log("flylayer-ipn was already stopped\n");await async function(t){const e={WantRunning:!1,WantRunningSet:!0};try{await i.default.getInstance().editPrefs(e)}catch(e){console.log("Error stopping flylayer-ipn service ",e),t.emit("serviceError",e)}}(t)}catch(e){t.emit("serviceError",e)}}},496:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.runLogout=void 0;const s=r(n(673));e.runLogout=async function(t){try{await s.default.getInstance().logout()}catch(e){console.log("Error logging out ",e),t.emit("serviceError",e)}}},978:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.runUp=void 0;const s=r(n(673)),i=n(402),o=n(332);async function a(t,e){try{await s.default.getInstance().editPrefs(e)}catch(e){t&&t.emit("serviceError",e)}}function A(t){return Object.assign(i.prefs,{ControlURL:t||o.IpnEnv.controlURL,ForceDaemon:"win32"===o.IpnEnv.platform})}e.runUp=async function(t,e=!1,n="",r){try{const c=await s.default.getInstance().status();c.BackendState===i.State.Running&&console.log("flylayer-ipn was already running\n");const u=A(r),l=await s.default.getInstance().getPrefs(),{simpleUp:h,justEditMP:d}=function(t,e,n,r=!1){const s=e.ControlURL!=t.ControlURL,a=null!=e.Config&&n!==i.State.NeedsLogin&&n!==i.State.NoState,c=!s&&!r;if(c){return{simpleUp:a,justEditMP:A(o.IpnEnv.controlURL)}}return{simpleUp:a,justEditMP:null}}(u,l,c.BackendState,e);null!==d&&a(null,{...d,WantRunningSet:!0,EggSet:!0}),h?a(t,{...u,WantRunning:!0,WantRunningSet:!0}):(await s.default.getInstance().start({UpdatePrefs:{...u},AuthKey:n}),e&&await s.default.getInstance().login())}catch(e){console.log("Error runUp flylayer-ipn service ",e),t.emit("serviceError",e)}}},930:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ipnEvents=void 0,e.ipnEvents={on_open_loginUrl:"on_open_loginUrl",on_ipn_state:"on_ipn_state",on_peers:"on_peers",on_serviceError:"on_serviceError",on_authkey_invalid:"on_authkey_invalid",on_add_log:"on_add_log"}},402:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.StateIntToStr=e.State=e.prefs=void 0,e.prefs={ControlURL:"",ConsoleURL:"",FYY:"",RouteAll:!0,AllowSingleHosts:!0,ExitNodeID:"",ExitNodeIP:"",ExitNodeAllowLANAccess:!1,CorpDNS:!0,RunSSH:!1,WantRunning:!0,LoggedOut:!1,ShieldsUp:!1,AdvertiseTags:null,Hostname:"",NotepadURLs:!1,AdvertiseRoutes:null,NoSNAT:!1,NetfilterMode:2,OperatorUser:"",Config:null,ForceDaemon:!1},function(t){t.NoState="NoState",t.InUseOtherUser="InUseOtherUser",t.NeedsLogin="NeedsLogin",t.NeedsMachineAuth="NeedsMachineAuth",t.Stopped="Stopped",t.Starting="Starting",t.Running="Running"}(n||(e.State=n={})),e.StateIntToStr={0:"NoState",1:"InUseOtherUser",2:"NeedsLogin",3:"NeedsMachineAuth",4:"Stopped",5:"Starting",6:"Running"}},332:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getdefaultSocketPath=e.IpnEnv=void 0,e.IpnEnv={controlURL:"",flylayer:"",flylayerd:"",servicePath:"",appName:"",platform:process.platform,pid:process.pid};e.getdefaultSocketPath=()=>"win32"===e.IpnEnv.platform?`\\\\.\\pipe\\ProtectedPrefix\\Administrators\\${e.IpnEnv.flylayer}\\${e.IpnEnv.flylayerd}`:"darwin"===e.IpnEnv.platform?`/var/run/${e.IpnEnv.flylayerd}.socket`:`/var/run/${e.IpnEnv.flylayer}/${e.IpnEnv.flylayerd}.sock`},457:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IpnEngine=void 0;const r=n(614);class s extends r.EventEmitter{constructor(){super()}}e.IpnEngine=s},452:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.IpnEngineEx=void 0;const s=n(129),i=r(n(605)),o=n(819),a=n(457),A=r(n(673)),c=n(20),u=n(402),l=n(930),h=n(332),d=n(496),p=n(978),f=n(163);class v extends a.IpnEngine{constructor(){super(),this.requesterManager=A.default.getInstance(),this.busUrl=`http://local-${h.IpnEnv.flylayerd}.sock/localapi/v0/watch-ipn-bus?mask=1`,this.handleEvents(),this.startWatcher()}broadcastState(t,e){this.emit(t,e)}async logout(){return await(0,d.runLogout)(this)}async login(t,e=""){return await this.requesterManager.SwitchToEmptyProfile(),await(0,p.runUp)(this,!0,e,t)}async up(t,e=""){return this.broadcastState(l.ipnEvents.on_ipn_state,u.State.Starting),this.startWatcher(),await(0,p.runUp)(this,t,e,null)}async down(){return await(0,f.runDown)(this)}async getStatus(){try{return await this.checkServiceStatus()?await this.requesterManager.status():{BackendState:u.State.NoState,Version:"",TUN:!1,AuthURL:"",TailscaleIPs:[],Self:{},Health:[],MagicDNSSuffix:"",CurrentFlynet:{},CertDomains:{},ExitNodeStatus:{},Peer:{},User:{}}}catch(t){throw console.log("getStatus error:",t),this.emit("serviceError",t),this.addLog(`getStatus error:${t}`),t}}async getStatusWithoutPeers(){try{return await this.requesterManager.statusWithoutPeers()}catch(t){throw console.log("getStatusWithoutPeers error:",t),this.emit("serviceError",t),this.addLog(`getStatusWithoutPeers error:${t}`),t}}async getProfile(){try{return await this.requesterManager.getProfile()}catch(t){throw console.log("getProfile error:",t),this.emit("serviceError",t),this.addLog(`getProfile error:${t}`),t}}async getProfiles(){try{return await this.requesterManager.getProfiles()}catch(t){throw console.log("getProfiles error:",t),this.emit("serviceError",t),this.addLog(`getProfiles error:${t}`),t}}async getPrefs(){try{return await this.requesterManager.getPrefs()}catch(t){throw console.log("getPrefs error:",t),this.emit("serviceError",t),this.addLog(`getPrefs error:${t}`),t}}async switchProfile(t){return this.addLog(`switchProfile: ${t}`),await this.requesterManager.switchProfile(t)}startFlylayerService(){return"win32"==h.IpnEnv.platform?new Promise(((t,e)=>{const n=`"${h.IpnEnv.servicePath}/flylayer-tools.exe" update-service "${h.IpnEnv.servicePath}" `;(0,s.exec)(n,((n,r,s)=>{n?(this.addLog(`startFlylayerService error:${n}`),e(!1)):t(!0)}))})):"linux"==h.IpnEnv.platform?new Promise(((t,e)=>{const n=`flylayer-${(new Date).getTime().toString()}`;(0,s.exec)(`mkdir /tmp/${n}/ && cp -fr ${h.IpnEnv.servicePath}/* /tmp/${n}/`,((r,o,a)=>{if(r)this.addLog(`Error creating directory:${r}`),e(!1);else{let r=this.getExecStr();r=`cd /tmp/${n}/ && ${r}`;const o={name:h.IpnEnv.appName};i.default.exec(r,o,((r,i,o)=>{r?(this.addLog(`startFlylayerService error:${r}`),(0,s.exec)(`rm -fr /tmp/${n}`,(()=>e(!1)))):(0,s.exec)(`rm -fr /tmp/${n}`,(()=>t(!0)))}))}}))})):"darwin"==h.IpnEnv.platform?new Promise(((t,e)=>{const n=`do shell script "${h.IpnEnv.servicePath}/installService.sh ${h.IpnEnv.servicePath} ${h.IpnEnv.flylayer} ${h.IpnEnv.flylayerd} " with administrator privileges`;o.execString(n,((n,r)=>{n?(this.addLog(`startFlylayerService error:${n}`),e(!1)):t(!0)}))})):Promise.resolve(!1)}async checkServiceStatus(){return this.isProcess(`${h.IpnEnv.flylayerd}`)}async checkIsNewVersion(t="C:\\Program Files"){const e=h.IpnEnv.servicePath,n=h.IpnEnv.flylayer,r=h.IpnEnv.flylayerd;if("win32"===h.IpnEnv.platform){const i=(0,s.execSync)(` "${e}/${r}.exe" -version`).toString(),o=i.substring(0,i.indexOf(n)).trim(),a=(0,s.execSync)(` "${t}\\${n}\\${r}.exe" -version`).toString();return o===a.substring(0,a.indexOf(n)).trim()}if("darwin"===h.IpnEnv.platform){const t=(0,s.execSync)(` "${e}/${r}" -version`).toString(),i=t.substring(0,t.indexOf(n)).trim(),o=(0,s.execSync)(` "/usr/local/bin/${r}" -version`).toString();return i===o.substring(0,o.indexOf(n)).trim()}const i=(0,s.execSync)(` "${e}/${r}" -version`).toString(),o=i.substring(0,i.indexOf(n)).trim(),a=(0,s.execSync)(`/usr/sbin/${r} -version`).toString();return o===a.substring(0,a.indexOf(n)).trim()}async upgradeSdk(){return this.startFlylayerService()}async setGuiInfo(t){const e={pid:t?h.IpnEnv.pid:0};return await this.requesterManager.setGuiInfo(e)}handleEvents(){this.on("serviceError",(t=>{t.includes("ECONNREFUSED")&&(console.log("ECONNREFUSED----------------"),this.addLog("ECONNREFUSED----------------"),this.emit(l.ipnEvents.on_serviceError,t),this.stopWatcher())}))}handlePeers(t){this.emit(l.ipnEvents.on_peers,t)}async startWatcher(){this.stopWatcher(),this.watcher=await(0,c.watchIPNBus)(this.busUrl),this.watcher.addListener((async t=>{if(t.error&&(console.log("watcher error:",t.ErrMessage),this.emit("serviceError",t.ErrMessage),this.addLog(t.ErrMessage)),"invalid auth key"===t.ErrMessage&&(this.addLog("invalid auth key"),this.emit(l.ipnEvents.on_authkey_invalid),this.stopWatcher()),t.BrowseToURL&&""!==t.BrowseToURL){(await this.getPrefs()).WantRunning&&this.emit(l.ipnEvents.on_open_loginUrl,t.BrowseToURL)}switch(u.StateIntToStr[t.State]){case u.State.Running:this.handleRunning();break;case u.State.NeedsMachineAuth:this.hanNeedsMachineAuth();break;case u.State.Stopped:this.handleStopped();break;case u.State.NeedsLogin:this.handleNeedsLogin();break;default:t&&t.NetMap&&t.NetMap.Peers&&this.handlePeers(t.NetMap.Peers)}}))}async handleRunning(){this.broadcastState(l.ipnEvents.on_ipn_state,u.State.Running),this.setGuiInfo(!0)}async handleStopped(){this.broadcastState(l.ipnEvents.on_ipn_state,u.State.Stopped),this.setGuiInfo(!1)}async handleNeedsLogin(){this.broadcastState(l.ipnEvents.on_ipn_state,u.State.NeedsLogin),this.setGuiInfo(!1)}async hanNeedsMachineAuth(){this.broadcastState(l.ipnEvents.on_ipn_state,u.State.NeedsMachineAuth)}stopWatcher(){this.watcher&&this.watcher.stop()}async isProcess(t){return new Promise(((e,n)=>{if("win32"===h.IpnEnv.platform){const r=`${t}.exe`,i="tasklist";(0,s.exec)(i,((i,o,a)=>{if(i){this.addLog(`isProcess error: ${i}`);const o=`wmic process where "name='${r}'" get ProcessId,Name`;(0,s.exec)(o,((r,s,i)=>{r?(this.addLog(`isProcess wmic error: ${r}`),n(!1)):s.toString().toLowerCase().includes(t.toLowerCase())?(this.addLog(`${t} is running.`),e(!0)):(this.addLog(`${t} is not running.`),e(!1))}))}else o.includes(r)?(this.addLog(`${r} is running.`),e(!0)):(this.addLog(`${r} is not running.`),e(!1))}))}else{const r=`ps -ef | grep -w "${t}" | grep -v grep | wc -l`;(0,s.exec)(r,((t,r,s)=>{t?(this.addLog(`isProcess error: ${t}`),n(!1)):"0"!==r.toString().trim()?e(!0):e(!1)}))}}))}getLinuxCmd(){return`systemctl stop  ${h.IpnEnv.flylayerd}.service && cp ${h.IpnEnv.flylayerd} /usr/sbin && cp ${h.IpnEnv.flylayer} /usr/sbin && chmod +x /usr/sbin/${h.IpnEnv.flylayerd} && chmod +x /usr/sbin/${h.IpnEnv.flylayer} && cp  systemd/${h.IpnEnv.flylayerd}.service /etc/systemd/system/ && cp  systemd/${h.IpnEnv.flylayerd}.defaults /etc/default/${h.IpnEnv.flylayerd} && systemctl enable  ${h.IpnEnv.flylayerd}.service && systemctl restart  ${h.IpnEnv.flylayerd}.service `}getExecStr(){switch(h.IpnEnv.platform){case"win32":return`sc stop ${h.IpnEnv.flylayer}  & sc delete ${h.IpnEnv.flylayer} & "${h.IpnEnv.servicePath}/${h.IpnEnv.flylayerd}.exe" install-system-daemon & sc start ${h.IpnEnv.flylayer}`;case"linux":return this.getLinuxCmd();default:return""}}addLog(t){this.emit(l.ipnEvents.on_add_log,`IpnEngine:${t}`)}}e.IpnEngineEx=v},354:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.createIpnEngine=void 0;const i=n(452),o=n(332);function a(t){Object.assign(o.IpnEnv,t),console.log(`IpnEnv------${JSON.stringify(o.IpnEnv)}}`);return new i.IpnEngineEx}s(n(930),e),s(n(402),e),s(n(332),e),s(n(452),e),s(n(457),e),e.createIpnEngine=a,e.default=a},584:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Requester=void 0;const s=r(n(876));class i{constructor(t,e){this.socketPath=t,this.host=e,this.options={socketPath:this.socketPath,path:"",host:this.host}}static getInstance(t,e){return i.instance||(i.instance=new i(t,e)),i.instance}makeRequest(t,e){const n={method:t.method||"GET",path:t.path||"/",socketPath:t.socketPath||this.options.socketPath,host:t.host||this.options.host};let r="";const i=s.default.request(n,(t=>{t.on("data",(t=>{r+=t.toString()})),t.on("end",(()=>{const n={statusCode:t.statusCode||0,body:""===r?"{}":r};e(n,i)}))}));i.on("error",(t=>{e({statusCode:0,body:t.message},i)})),t.body&&i.write(JSON.stringify(t.body)),i.end()}}e.Requester=i},673:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(584),s=n(332);class i{constructor(){this.socketPath=(0,s.getdefaultSocketPath)(),this.host=`local-${s.IpnEnv.flylayerd}.sock`,this.requester=r.Requester.getInstance(this.socketPath,this.host)}static getInstance(){return i.instance||(i.instance=new i),i.instance}checkStatus200(t){return 200===t}checkStatus201(t){return 201===t}checkStatus204(t){return 204===t}async getProfile(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/profiles/current",method:"GET"},((n,r)=>{this.checkStatus200(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async getProfiles(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/profiles/",method:"GET"},((n,r)=>{this.checkStatus200(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async status(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/status",method:"GET"},((n,r)=>{this.checkStatus200(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async statusWithoutPeers(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/status?peers=false",method:"GET"},((n,r)=>{this.checkStatus200(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async editPrefs(t){return new Promise(((e,n)=>{this.requester.makeRequest({path:"/localapi/v0/prefs",method:"PATCH",body:t},((t,r)=>{this.checkStatus200(t.statusCode)?e(JSON.parse(t.body)):n(t.body)}))}))}async getPrefs(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/prefs",method:"GET"},((n,r)=>{this.checkStatus200(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async logout(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/logout",method:"POST"},((n,r)=>{this.checkStatus204(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async start(t){return new Promise(((e,n)=>{this.requester.makeRequest({path:"/localapi/v0/start",method:"POST",body:t},((t,r)=>{this.checkStatus204(t.statusCode)?e(JSON.parse(t.body)):n(t.body)}))}))}async setGuiInfo(t){return new Promise(((e,n)=>{this.requester.makeRequest({path:"/localapi/v0/gui-info",method:"POST",body:t},((t,r)=>{this.checkStatus200(t.statusCode)?e(JSON.parse(t.body)):n(t.body)}))}))}SwitchToEmptyProfile(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/profiles/",method:"PUT"},((n,r)=>{this.checkStatus201(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async login(){return new Promise(((t,e)=>{this.requester.makeRequest({path:"/localapi/v0/login-interactive",method:"POST"},((n,r)=>{this.checkStatus204(n.statusCode)?t(JSON.parse(n.body)):e(n.body)}))}))}async switchProfile(t){return new Promise(((e,n)=>{this.requester.makeRequest({path:`/localapi/v0/profiles/${t}`,method:"POST"},((t,r)=>{this.checkStatus204(t.statusCode)?e(JSON.parse(t.body)):n(t.body)}))}))}}i.instance=null,e.default=i},20:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.watchIPNBus=void 0;const s=r(n(876)),i=n(332);class o{constructor(t){this.url=t,this.req=null,this.res=null,this.buffer="",this.listeners=new Map,this.closed=!1,this.handleData=t=>{for(this.buffer+=t;this.buffer.indexOf("\n")>=0;){const t=this.buffer.indexOf("\n"),e=this.buffer.slice(0,t).trim();if(this.buffer=this.buffer.slice(t+1),e){const t=JSON.parse(e);this.listeners.forEach((e=>{e(t)}))}}},this.restartIfNotClosed=()=>{this.closed||setTimeout((()=>this.start()),5e3)},this.handleError=t=>{console.error("watchIPNBus error: ",t.message),this.closed||setTimeout((()=>this.start()),5e3),this.listeners.forEach((t=>{t({BrowseToURL:"",error:!0,State:0,NetMap:"",ErrMessage:"service Error"})}))}}async start(){try{const t={socketPath:(0,i.getdefaultSocketPath)(),path:new URL(this.url).pathname,host:new URL(this.url).host};this.req=s.default.get(t,(t=>{this.res=t,t.setEncoding("utf8"),t.on("data",this.handleData),t.on("end",this.restartIfNotClosed)})),this.req.on("error",this.handleError)}catch(t){this.handleError(t)}}addListener(t){this.listeners.set(t,t)}removeListener(t){this.listeners.delete(t)}async stop(){this.closed||(this.closed=!0,this.res&&this.res.destroy(),this.req&&this.req.abort(),this.listeners.clear())}}e.watchIPNBus=async function(t){const e=new o(t);return await e.start(),e}},605:(t,e,n)=>{var r={child:n(129),crypto:n(417),fs:n(747),os:n(87),path:n(622),process,util:n(669)};function s(t,e){var n=r.process.platform;return"darwin"===n?function(t,e){var n=r.os.tmpdir();if(!n)return e(new Error("os.tmpdir() not defined."));if(!r.process.env.USER)return e(new Error("env['USER'] not defined."));a(t,(function(s,a){if(s)return e(s);function A(n,s,i){o(r.path.dirname(t.path),(function(t){return n?e(n):t?e(t):void e(void 0,s,i)}))}t.uuid=a,t.path=r.path.join(n,t.uuid,t.options.name+".app"),function(t,e){var n=r.path.dirname(t.path);r.fs.mkdir(n,(function(s){if(s)return e(s);var o=r.path.join(n,"sudo-prompt-applet.zip");r.fs.writeFile(o,u,"base64",(function(n){if(n)return e(n);var s=[];s.push("/usr/bin/unzip"),s.push("-o"),s.push('"'+i(o)+'"'),s.push('-d "'+i(t.path)+'"'),s=s.join(" "),r.child.exec(s,{encoding:"utf-8"},e)}))}))}(t,(function(e,n,s){if(e)return A(e,n,s);!function(t,e){if(!t.options.icns)return e();r.fs.readFile(t.options.icns,(function(n,s){if(n)return e(n);var i=r.path.join(t.path,"Contents","Resources","applet.icns");r.fs.writeFile(i,s,e)}))}(t,(function(e){if(e)return A(e);!function(t,e){var n=r.path.join(t.path,"Contents","Info.plist"),s=i(n),o=i("CFBundleName"),a=t.options.name+" Password Prompt";if(/'/.test(a))return e(new Error("Value should not contain single quotes."));var A=[];A.push("/usr/bin/defaults"),A.push("write"),A.push('"'+s+'"'),A.push('"'+o+'"'),A.push("'"+a+"'"),A=A.join(" "),r.child.exec(A,{encoding:"utf-8"},e)}(t,(function(e,n,s){if(e)return A(e,n,s);!function(t,e){var n=r.path.join(t.path,"Contents","MacOS","sudo-prompt-command"),s=[];for(var o in s.push('cd "'+i(r.process.cwd())+'"'),t.options.env){var a=t.options.env[o];s.push("export "+o+'="'+i(a)+'"')}s.push(t.command),s=s.join("\n"),r.fs.writeFile(n,s,"utf-8",e)}(t,(function(e){if(e)return A(e);!function(t,e){var n=r.path.join(t.path,"Contents","MacOS","applet"),s={cwd:r.path.dirname(n),encoding:"utf-8"};r.child.exec("./"+r.path.basename(n),s,e)}(t,(function(e,n,s){if(e)return A(e,n,s);!function(t,e){var n=r.path.join(t.path,"Contents","MacOS");r.fs.readFile(r.path.join(n,"code"),"utf-8",(function(s,i){if(s){if("ENOENT"===s.code)return e(new Error(l));e(s)}else r.fs.readFile(r.path.join(n,"stdout"),"utf-8",(function(s,o){if(s)return e(s);r.fs.readFile(r.path.join(n,"stderr"),"utf-8",(function(n,r){if(n)return e(n);0===(i=parseInt(i.trim(),10))?e(void 0,o,r):((n=new Error("Command failed: "+t.command+"\n"+r)).code=i,e(n,o,r))}))}))}))}(t,A)}))}))}))}))}))}))}(t,e):"linux"===n?function(t,e){!function(t,e){var n=0,s=["/usr/bin/kdesudo","/usr/bin/pkexec"];function i(){if(n===s.length)return e(new Error("Unable to find pkexec or kdesudo."));var t=s[n++];r.fs.stat(t,(function(n){if(n){if("ENOTDIR"===n.code)return i();if("ENOENT"===n.code)return i();e(n)}else e(void 0,t)}))}i()}(0,(function(n,s){if(n)return e(n);var o=[];for(var a in o.push('cd "'+i(r.process.cwd())+'";'),t.options.env){var A=t.options.env[a];o.push("export "+a+'="'+i(A)+'";')}o.push('"'+i(s)+'"'),/kdesudo/i.test(s)?(o.push("--comment",'"'+t.options.name+' wants to make changes. Enter your password to allow this."'),o.push("-d"),o.push("--")):/pkexec/i.test(s)&&o.push("--disable-internal-agent");var c="SUDOPROMPT\n";o.push('/bin/bash -c "echo '+i(c.trim())+"; "+i(t.command)+'"'),o=o.join(" "),r.child.exec(o,{encoding:"utf-8",maxBuffer:d},(function(t,n,r){var s=n&&n.slice(0,c.length)===c;s&&(n=n.slice(c.length)),t&&!s&&(/No authentication agent found/.test(r)?t.message=h:t.message=l),e(t,n,r)}))}))}(t,e):"win32"===n?function(t,e){var n=r.os.tmpdir();if(!n)return e(new Error("os.tmpdir() not defined."));a(t,(function(s,i){return s?e(s):(t.uuid=i,t.path=r.path.join(n,t.uuid),/"/.test(t.path)?e(new Error("instance.path cannot contain double-quotes.")):(t.pathElevate=r.path.join(t.path,"elevate.vbs"),t.pathExecute=r.path.join(t.path,"execute.bat"),t.pathCommand=r.path.join(t.path,"command.bat"),t.pathStdout=r.path.join(t.path,"stdout"),t.pathStderr=r.path.join(t.path,"stderr"),t.pathStatus=r.path.join(t.path,"status"),void r.fs.mkdir(t.path,(function(n){if(n)return e(n);function s(n,r,s){o(t.path,(function(t){return n?e(n):t?e(t):void e(void 0,r,s)}))}!function(t,e){var n=[];n.push("@echo off"),n.push('call "'+t.pathCommand+'" > "'+t.pathStdout+'" 2> "'+t.pathStderr+'"'),n.push('(echo %ERRORLEVEL%) > "'+t.pathStatus+'"'),n=n.join("\r\n"),r.fs.writeFile(t.pathExecute,n,"utf-8",e)}(t,(function(e){if(e)return s(e);!function(t,e){var n=r.process.cwd();if(/"/.test(n))return e(new Error("process.cwd() cannot contain double-quotes."));var s=[];for(var i in s.push("@echo off"),s.push("chcp 65001>nul"),s.push('cd /d "'+n+'"'),t.options.env){var o=t.options.env[i];s.push("set "+i+"="+o.replace(/([<>\\|&^])/g,"^$1"))}s.push(t.command),s=s.join("\r\n"),r.fs.writeFile(t.pathCommand,s,"utf-8",e)}(t,(function(e){if(e)return s(e);!function(t,e){var n=[];n.push("powershell.exe"),n.push("Start-Process"),n.push("-FilePath"),n.push("\"'"+t.pathExecute.replace(/'/g,"`'")+"'\""),n.push("-WindowStyle hidden"),n.push("-Verb runAs"),n=n.join(" ");var s=r.child.exec(n,{encoding:"utf-8"},(function(t,n,r){if(t)return e(new Error(l),n,r);e()}));s.stdin.end()}(t,(function(e,n,i){if(e)return s(e,n,i);c(t,(function(e){if(e)return s(e);!function(t,e){r.fs.readFile(t.pathStatus,"utf-8",(function(n,s){if(n)return e(n);r.fs.readFile(t.pathStdout,"utf-8",(function(n,i){if(n)return e(n);r.fs.readFile(t.pathStderr,"utf-8",(function(n,r){if(n)return e(n);0===(s=parseInt(s.trim(),10))?e(void 0,i,r):((n=new Error("Command failed: "+t.command+"\r\n"+r)).code=s,e(n,i,r))}))}))}))}(t,s)}))}))}))}))}))))}))}(t,e):void e(new Error("Platform not yet supported."))}function i(t){if("string"!=typeof t)throw new Error("Expected a string.");return t.replace(/"/g,'\\"')}function o(t,e){if("string"!=typeof t||!t.trim())return e(new Error("Argument path not defined."));var n=[];if("win32"===r.process.platform){if(/"/.test(t))return e(new Error("Argument path cannot contain double-quotes."));n.push('rmdir /s /q "'+t+'"')}else n.push("/bin/rm"),n.push("-rf"),n.push('"'+i(r.path.normalize(t))+'"');n=n.join(" "),r.child.exec(n,{encoding:"utf-8"},e)}function a(t,e){r.crypto.randomBytes(256,(function(n,s){n&&(s=Date.now()+""+Math.random());var i=r.crypto.createHash("SHA256");i.update("sudo-prompt-3"),i.update(t.options.name),i.update(t.command),i.update(s);var o=i.digest("hex").slice(-32);if(!o||"string"!=typeof o||32!==o.length)return e(new Error("Expected a valid UUID."));e(void 0,o)}))}function A(t){return!!/^[a-z0-9 ]+$/i.test(t)&&(0!==t.trim().length&&!(t.length>70))}function c(t,e){r.fs.stat(t.pathStatus,(function(n,s){n&&"ENOENT"===n.code||s.size<2?setTimeout((function(){r.fs.stat(t.pathStdout,(function(n){if(n)return e(new Error(l));c(t,e)}))}),1e3):n?e(n):e()}))}t.exports.exec=function(){if(arguments.length<1||arguments.length>3)throw new Error("Wrong number of arguments.");var t=arguments[0],e={},n=function(){};if("string"!=typeof t)throw new Error("Command should be a string.");if(2===arguments.length)if(r.util.isObject(arguments[1]))e=arguments[1];else{if(!r.util.isFunction(arguments[1]))throw new Error("Expected options or callback.");n=arguments[1]}else if(3===arguments.length){if(!r.util.isObject(arguments[1]))throw new Error("Expected options to be an object.");if(e=arguments[1],!r.util.isFunction(arguments[2]))throw new Error("Expected callback to be a function.");n=arguments[2]}if(/^sudo/i.test(t))return n(new Error('Command should not be prefixed with "sudo".'));if(void 0===e.name){var i=r.process.title;if(!A(i))return n(new Error("process.title cannot be used as a valid name."));e.name=i}else if(!A(e.name)){return"options.name must be alphanumeric only ","(spaces are allowed) and <= 70 characters.",n(new Error("options.name must be alphanumeric only (spaces are allowed) and <= 70 characters."))}if(void 0!==e.icns){if("string"!=typeof e.icns)return n(new Error("options.icns must be a string if provided."));if(0===e.icns.trim().length)return n(new Error("options.icns must not be empty if provided."))}if(void 0!==e.env){if("object"!=typeof e.env)return n(new Error("options.env must be an object if provided."));if(0===Object.keys(e.env).length)return n(new Error("options.env must not be empty if provided."));for(var o in e.env){var a=e.env[o];if("string"!=typeof o||"string"!=typeof a)return n(new Error("options.env environment variables must be strings."));if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(o))return n(new Error("options.env has an invalid environment variable name: "+JSON.stringify(o)));if(/[\r\n]/.test(a))return n(new Error("options.env has an invalid environment variable value: "+JSON.stringify(a)))}}var c=r.process.platform;if("darwin"!==c&&"linux"!==c&&"win32"!==c)return n(new Error("Platform not yet supported."));s({command:t,options:e,uuid:void 0,path:void 0},n)};var u="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",l="User did not grant permission.",h="No polkit authentication agent found.",d=134217728},797:(t,e)=>{function n(){var t=this.value[this.index];switch(t){case"{":return e.ArrayParser.call(this);case'"':return e.StringParser.call(this);case"a":if("alias"==this.value.substring(this.index,this.index+5))return e.AliasParser.call(this);break;case"芦":if("芦data"==this.value.substring(this.index,this.index+5))return e.DataParser.call(this)}return isNaN(t)?e.UndefinedParser.call(this):e.NumberParser.call(this)}e.parse=function(t){if(0!=t.length)return n.call({value:t,index:0})},e.AliasParser=function(){return this.index+=6,"/Volumes/"+e.StringParser.call(this).replace(/:/g,"/")},e.ArrayParser=function(){for(var t=[],e=this.value[++this.index];"}"!=e;)t.push(n.call(this)),","==this.value[this.index]&&(this.index+=2),e=this.value[this.index];return this.index++,t},e.DataParser=function(){var t=e.UndefinedParser.call(this),n=(t=t.substring(6,t.length-1)).substring(0,4);t=t.substring(4,t.length);for(var r=new Buffer(t.length/2),s=0,i=0,o=t.length;i<o;i+=2)r[s++]=parseInt(t[i]+t[i+1],16);return r.type=n,r},e.NumberParser=function(){return Number(e.UndefinedParser.call(this))},e.StringParser=function(t){for(var e="",n=++this.index,r=this.value[n++];'"'!=r;)"\\"==r&&(e+=this.value.substring(this.index,n-1),this.index=n++),r=this.value[n++];return e+=this.value.substring(this.index,n-1),this.index=n,e};var r=/}|,|\n/;e.UndefinedParser=function(){for(var t=this.index,e=this.value[t++];!r.test(e);)e=this.value[t++];var n=this.value.substring(this.index,t-1);return this.index=t-1,n}},819:(t,e,n)=>{var r=n(129).spawn;e.Parsers=n(797);var s=e.Parsers.parse;function i(t,n,i){var a=!1;Array.isArray(n)||(i=n,n=[],a=!0),n.push("-ss"),a||n.push(t);var A=r(e.osascript,n);o(A.stdout),o(A.stderr),A.on("exit",(function(e){var n,r=s(A.stdout.body);e&&((n=new Error(A.stderr.body)).appleScript=t,n.exitCode=e),i&&i(n,r,A.stderr.body)})),a&&(A.stdin.write(t),A.stdin.end())}function o(t){t.body="",t.setEncoding("utf8"),t.on("data",(function(e){t.body+=e}))}e.osascript="osascript",e.execFile=function(t,e,n){return Array.isArray(e)||(n=e,e=[]),i(t,e,n)},e.execString=function(t,e){return i(t,e)}},590:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>A});var r,s,i=n(354);!function(t){t.ipn_state="ipn_state",t.ipn_service_state="ipn_service_state",t.ipn_invalid_auth_key="ipn_invalid_auth_key"}(r||(r={})),function(t){t.NoState="鏃?,t.InUseOtherUser="鍏朵粬鐢ㄦ埛鍦ㄤ娇鐢ㄤ腑",t.NeedsLogin="闇€瑕佺櫥褰?,t.NeedsMachineAuth="绛夊緟瀹℃壒",t.Stopped="宸插仠姝?,t.Starting="鍚姩涓?,t.Running='杩愯涓?'}(s||(s={}));var o=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{A(r.next(t))}catch(t){i(t)}}function a(t){try{A(r.throw(t))}catch(t){i(t)}}function A(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}A((r=r.apply(t,e||[])).next())}))},a=function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};const A=new(function(){function t(){var t=this;this.isEscape=!1,this.programFilesPath="C:\\Program Files",this.onServiceError=function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){return this.post({name:"ZVPN:serviceState",params:{serviceState:!1},disableRemove:!0}),[2]}))}))},this.onAuthkeyInvalid=function(){return o(t,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,this.getIsBaohe()];case 1:return t=e.sent(),this.log.error("legovpn锛歛uthKey澶辨晥 璇烽噸鏂扮櫥褰?isbaohe: ".concat(t)),t?(this.post({name:"ZVPN:authkeyState",params:{authkeyState:!1},disableRemove:!0}),[2]):[2]}}))}))},this.onStateChanged=function(e){return o(t,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return[4,this.getIsBaohe()];case 1:return t=o.sent(),this.log.error("legovpn锛歴tate鐩戝惉 isbaohe: ".concat(t)),t?(n=!1,"",e===i.State.Running&&(n=!0),r=s[e],this.currentState=e,this.log.error("legovpn锛歴tate鐩戝惉".concat(e)),this.post({name:"ZVPN:state",params:{success:n,errorMsg:r,state:e},disableRemove:!0}),[2]):(this.post({name:"ZVPN:state",params:{success:!1,errorMsg:"涓嶆槸瀹濈洅",state:"No"},disableRemove:!0}),[2])}}))}))},this.onOpenLoginUrl=function(e){return o(t,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,this.getIsBaohe()];case 1:return t=n.sent(),this.log.info("legovpn锛氭墦寮€鐩戝惉".concat(e," isbaohe: ").concat(t)),t?this.consoleUrl&&e.indexOf(this.consoleUrl)<0?(this.log.info("legovpn锛氭墦寮€鐩戝惉 error ".concat(e)),[2]):(this.openUrl(e),[2]):[2]}}))}))}}return t.prototype.init=function(t){return o(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,t.getLoginParams()];case 1:return(e=r.sent()).url===this.controlURL||(this.removeListener(),this.log=t.log,this.post=t.post,this.openUrl=t.openUrl,this.controlURL=e.url,this.consoleUrl=e.consoleUrl,this.currentUser=e.currentUser,this.isEscape=e.isEscape,n={controlURL:e.url,flylayer:"flylayer",flylayerd:"flylayerd",appName:"baohe",servicePath:e.servicePath},this.ipnEngine=(0,i.createIpnEngine)(n),this.log.info("legovpn:init鍙傛暟".concat(JSON.stringify(n))),this.addListener(),this.isEscape||this.handleState("init")),[2]}}))}))},t.prototype.handleState=function(t){return o(this,void 0,void 0,(function(){var e,n,r,s=this;return a(this,(function(A){switch(A.label){case 0:return e=function(){return o(s,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return"init"===t?[3,3]:(this.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪杩涜vpn鐗堟湰妫€娴?.."},disableRemove:!0}),this.log.info("legovpn锛氱増鏈娴嬪紑濮?),[4,this.ipnEngine.checkIsNewVersion(this.programFilesPath)]);case 1:return e=n.sent(),this.log.info("legovpn锛氱増鏈娴嬬粨鏋?.concat(e)),e?[3,3]:(this.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪杩涜vpn鐗堟湰鍗囩骇..."},disableRemove:!0}),this.log.info("legovpn锛氬崌绾у埌鏂扮増鏈?),[4,this.ipnEngine.upgradeSdk()]);case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},[4,this.checkService()];case 1:return n=A.sent(),this.log.info("legovpn锛氭湇鍔℃槸鍚﹀惎鍔?.concat(n)),n?[3,4]:"init"===t?[3,3]:(this.log.info("legovpn锛氭湇鍔℃湭鍚姩锛屽惎鍔ㄦ湇鍔?),this.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪鍚姩vpn鏈嶅姟..."},disableRemove:!0}),[4,this.startService()]);case 2:A.sent(),A.label=3;case 3:return[2,!0];case 4:return[4,e()];case 5:return A.sent(),r=function(t){return o(s,void 0,void 0,(function(){var e,n=this;return a(this,(function(s){switch(s.label){case 0:return[4,this.getStates()];case 1:return e=s.sent(),this.log.info("legovpn: 閫掑綊鐘舵€?".concat(JSON.stringify(e))),"NO"===e.state?[3,3]:(this.log.info("legovpn锛氱粨鏉熼€掑綊1"),[4,t(e)]);case 2:return[2,s.sent()];case 3:return this.log.info("legovpn锛氶€掑綊1"),[2,new Promise((function(e){var s=setTimeout((function(){return o(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return[4,r(t)];case 1:return n=i.sent(),e(n),clearTimeout(s),[2]}}))}))}),2e3)}))]}}))}))},[4,r((function(t){return o(s,void 0,void 0,(function(){var e,n,r,s,o,A,c;return a(this,(function(a){switch(a.label){case 0:return this.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪杩涜鐧诲綍淇℃伅姣斿..."},disableRemove:!0}),t.state===i.State.NoState||t.state===i.State.NeedsLogin?[3,2]:[4,this.getProfile()];case 1:return e=a.sent(),this.log.info("legovpn锛氱敤鎴蜂俊鎭痷serInfo:".concat(JSON.stringify(e))),this.log.info("legovpn锛氱敤鎴蜂俊鎭痗urrentUser:".concat(JSON.stringify(this.currentUser))),this.log.info("legovpn锛氱敤鎴蜂俊鎭瘮瀵圭粨鏋?".concat((null===(n=null==e?void 0:e.UserProfile)||void 0===n?void 0:n.LoginName)==="".concat((null===(r=this.currentUser)||void 0===r?void 0:r.username)||(null===(s=this.currentUser)||void 0===s?void 0:s.userName),"@zto"))),(null===(o=null==e?void 0:e.UserProfile)||void 0===o?void 0:o.LoginName)==="".concat((null===(A=this.currentUser)||void 0===A?void 0:A.username)||(null===(c=this.currentUser)||void 0===c?void 0:c.userName),"@zto")&&(null==e?void 0:e.ControlURL)===this.controlURL?(this.log.info("legovpn锛氱敤鎴蜂俊鎭浉鍚?),[2,!0]):(this.log.info("legovpn锛氱敤鎴蜂俊鎭笉鍚?),(null==e?void 0:e.ControlURL.indexOf("zt-express"))>=0&&this.logout(),[2,!1]);case 2:return[2,!0];case 3:return[2]}}))}))}))];case 6:return[2,A.sent()]}}))}))},t.prototype.checkService=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.ipnEngine.checkServiceStatus()];case 1:return[2,t.sent()];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.startService=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.ipnEngine.startFlylayerService()];case 1:return[2,t.sent()]}}))}))},t.prototype.setAuthKey=function(t){this.log.info("legovpn锛歛uthKey ".concat(t)),this.authKey=t},t.prototype.connect=function(t){return o(this,void 0,void 0,(function(){var e,n,r=this;return a(this,(function(s){switch(s.label){case 0:return this.programFilesPath=t,[4,this.handleState("connect")];case 1:return e=s.sent(),this.log.info("legovpn锛氭湇鍔℃娴嬬粨鏋?.concat(e)),n=function(t){return o(r,void 0,void 0,(function(){var r,s;return a(this,(function(o){switch(o.label){case 0:return[4,this.getStates()];case 1:return r=o.sent(),this.log.info("legovpn: 閫掑綊鐘舵€?.concat(JSON.stringify(r))),e&&"NO"!==r.state||!e&&"NO"!==r.state&&r.state===i.State.NeedsLogin?(this.log.info("legovpn锛氱粨鏉熼€掑綊"),t&&t()):(this.log.info("legovpn锛氶€掑綊"),s=setTimeout((function(){n(t),clearTimeout(s)}),2e3)),[2]}}))}))},e?[3,3]:(this.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪杩涜浠ｇ悊杩炴帴璇锋眰..."},disableRemove:!0}),[4,this.getIsBaohe()]);case 2:return s.sent()?(n((function(){r.log.info("legovpn锛氱櫥褰?.concat(r.authKey)),r.isEscape?r.ipnEngine.up(!0):r.ipnEngine.up(!0,r.authKey)})),[2]):(this.log.info("legovpn锛氫箣鍓嶄笉鏄疂鐩掔鎴凤紝涓嶇櫥鍑猴紝鐩存帴鐧诲綍"),this.ipnEngine.login(this.controlURL,this.authKey),[2]);case 3:return this.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪杩涜vpn鐘舵€佹牳鏌?.."},disableRemove:!0}),n((function(){r.log.info("legovpn锛氱櫥褰曡繛鎺ュ墠鐘舵€?.concat(r.currentState)),r.post({name:"ZVPN:currentText",params:{text:"姝ｅ湪杩涜浠ｇ悊杩炴帴璇锋眰..."},disableRemove:!0}),r.currentState&&r.currentState!==i.State.NoState&&r.currentState!==i.State.NeedsLogin?r.currentState===i.State.Stopped&&(r.log.info("legovpn锛氳繛鎺?),r.ipnEngine.up()):(r.log.info("legovpn锛氱櫥褰?.concat(r.authKey," , ").concat(r.isEscape)),r.isEscape?r.ipnEngine.up(!0):r.ipnEngine.up(!0,r.authKey))})),[2]}}))}))},t.prototype.disconnect=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,this.getIsBaohe()];case 1:return t=e.sent(),this.log.info("legovpn锛氭柇寮€杩炴帴 isbaohe: ".concat(t)),t?(this.ipnEngine.down(),[2]):[2]}}))}))},t.prototype.logout=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,this.getIsBaohe()];case 1:return t=e.sent(),this.log.info("legovpn锛氭敞閿€鐧诲嚭 isbaohe: ".concat(t)),t?(this.ipnEngine.logout(),[2]):[2]}}))}))},t.prototype.getIsBaohe=function(){return o(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.getProfile()];case 1:return t=e.sent(),this.log.info("legovpn锛氳幏鍙栧綋鍓嶇粍缁囦俊鎭細"+JSON.stringify(t)),!(null==t?void 0:t.ControlURL)||(null==t?void 0:t.ControlURL.indexOf("zt-express"))>=0?[2,!0]:[2,!1];case 2:return e.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.getProfile=function(){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.ipnEngine.getProfile()];case 1:return[2,t.sent()];case 2:throw t.sent();case 3:return[2]}}))}))},t.prototype.getState=function(){return o(this,void 0,void 0,(function(){var t,e,n;return a(this,(function(r){switch(r.label){case 0:return[4,this.getIsBaohe()];case 1:if(t=r.sent(),this.log.info("legovpn锛氳幏鍙栫姸鎬佺姸鎬?isbaohe: ".concat(t)),!t)return[2,{success:!1,errorMsg:"鏈幏鍙栧埌鐘舵€佷俊鎭?,state:"NO"}];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.ipnEngine.getStatus()];case 3:return e=r.sent(),this.log.info("legovpn锛氳幏鍙栫姸鎬?.concat(JSON.stringify(e))),n={success:!1,errorMsg:"",state:e.BackendState},e.BackendState===i.State.Running&&(n.success=!0),n.errorMsg=s[e.BackendState],this.currentState=e.BackendState,[2,n];case 4:return r.sent(),[2,{success:!1,errorMsg:"鏈幏鍙栧埌鐘舵€佷俊鎭?,state:"NO"}];case 5:return[2]}}))}))},t.prototype.getStates=function(){return o(this,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.ipnEngine.getStatus()];case 1:return t=n.sent(),this.log.info("legovpn锛氳幏鍙栫姸鎬?.concat(JSON.stringify(t))),e={success:!1,errorMsg:"",state:t.BackendState},t.BackendState===i.State.Running&&(e.success=!0),e.errorMsg=s[t.BackendState],this.currentState=t.BackendState,[2,e];case 2:return n.sent(),[2,{success:!1,errorMsg:"鏈幏鍙栧埌鐘舵€佷俊鎭?,state:"NO"}];case 3:return[2]}}))}))},t.prototype.addListener=function(){this.ipnEngine.on(i.ipnEvents.on_ipn_state,this.onStateChanged),this.ipnEngine.on(i.ipnEvents.on_serviceError,this.onServiceError),this.ipnEngine.on(i.ipnEvents.on_authkey_invalid,this.onAuthkeyInvalid),this.ipnEngine.on(i.ipnEvents.on_open_loginUrl,this.onOpenLoginUrl)},t.prototype.removeListener=function(){this.ipnEngine&&(this.ipnEngine.off(i.ipnEvents.on_ipn_state,this.onStateChanged),this.ipnEngine.off(i.ipnEvents.on_serviceError,this.onServiceError),this.ipnEngine.off(i.ipnEvents.on_authkey_invalid,this.onAuthkeyInvalid),this.ipnEngine.off(i.ipnEvents.on_open_loginUrl,this.onOpenLoginUrl))},t}())},129:t=>{"use strict";t.exports=require("child_process")},417:t=>{"use strict";t.exports=require("crypto")},614:t=>{"use strict";t.exports=require("events")},747:t=>{"use strict";t.exports=require("fs")},876:t=>{"use strict";t.exports=require("http")},87:t=>{"use strict";t.exports=require("os")},622:t=>{"use strict";t.exports=require("path")},669:t=>{"use strict";t.exports=require("util")}},e={};function n(r){if(e[r])return e[r].exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}return n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(590)})()}));
